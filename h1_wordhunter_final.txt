#include <stdio.h>
#include <math.h>
#include <string.h>

// These are macros
#define SIZE 15
#define MAX_WORDS 10
#define WORD_LENGTH 20



// This number is used to make random letters
int next = 12345;

// This structure holds all the info for one word
typedef struct {
    char word[WORD_LENGTH]; 
    int x1;              
    int y1;                
    int x2;              
    int y2;                
    int found;              
} WordItem;

// This structure holds the whole game:the map and the lisst of words
typedef struct {
    char map[SIZE][SIZE];       
    WordItem words[MAX_WORDS];  
    int wordCount;            
} Puzzle;

// Telling the program these functions exist so we can use them
Puzzle fill_random_map(Puzzle p);
void print_puzzle(Puzzle p);
Puzzle place_single_word(Puzzle p, WordItem w);
Puzzle place_all_words(Puzzle p);
int search_in_direction(Puzzle p, char guess[], int r, int c, int dr, int dc);
int find_word_direction(Puzzle p, char guess[], int r, int c, int *dr, int *dc);
Puzzle uppercase_found_word(Puzzle p, char guess[], int r, int c, int dr, int dc);
Puzzle mark_word_as_found(Puzzle p, char guess[]);
int all_words_found(Puzzle p);
void play_game();




// Main function: the program starts here
int main() {
    play_game();
    return 0;
}

// This function fills the bord with random letters
Puzzle fill_random_map(Puzzle p) {
    int i;int j;
    unsigned int temp;
    
    char random_char;
    
   
    for (i = 0; i < SIZE; i++) {
    	
   
        for (j = 0; j < SIZE; j++) {
            // Math formula to get a random number
            next = next * 1103515245 + 12345;
            temp = (unsigned int)(next / 65536);
            
            temp = temp % 32768;
            
            
            // Turn the number into a letter a-z
            random_char = (char)('a' + (temp % 26));
            
            
            // Put the letter in the map
            p.map[i][j] = random_char;
        }
    }
    return p;
}

// This function prints the board to the screen
void print_puzzle(Puzzle p) {
    int i;int j;

    printf("\n----- PUZZLE -----\n");

    for (i = 0; i < SIZE; i++) {
    	
 
        for (j = 0; j < SIZE; j++) {
    
            printf("%c ", p.map[i][j]);
        }
        printf("\n");
        
        
    }
    printf("------------------\n");
}

// This function puts a single word onto the board
Puzzle place_single_word(Puzzle p, WordItem w) {
    int r, c,r_end,c_end,dr,dc,i,len;
    r = w.x1;
    c = w.y1;
    r_end = w.x2;
    c_end = w.y2;
    
    dr = 0;
    dc = 0;

    // Check if word goes down or up
    if (r_end > r) {
        dr = 1;
    } else {
        if (r_end < r) {
            dr = -1;
        }
    }

    // Check if word goes right or left
    if (c_end > c) {
        dc = 1;
    } else {
    	
        if (c_end < c) {
            dc = -1;
        }
    }

    len = (int)strlen(w.word); // Get length of the word

    // Loop to place each letter
    for (i = 0; i < len; i++) {
        // Make sure we don't go outside the board
        if (r >= 0) {
        	
            if (r < SIZE) {
                if (c >= 0) {
                	
                    if (c < SIZE) {
                    	
                        // Place the letter
                        p.map[r][c] = w.word[i];
                    }
                }
            }
        }
        // Move to the next spot
        r = r + dr;
        c = c + dc;
    }

    return p;
}

// This function sets up the specific words for the game
Puzzle place_all_words(Puzzle p) {
    p.wordCount = 0;

    // Word 1: great
    strcpy(p.words[0].word, "great");
    p.words[0].x1 = 0;
    p.words[0].y1 = 0;
    p.words[0].x2 = 0;
    p.words[0].y2 = 4;
    p.words[0].found = 0;
    p = place_single_word(p, p.words[0]);
    p.wordCount = p.wordCount + 1;

    // Word 2: hello
    strcpy(p.words[1].word, "hello");
    p.words[1].x1 = 5;
    p.words[1].y1 = 0;
    p.words[1].x2 = 5;
    p.words[1].y2 = 4;
    p.words[1].found = 0;
    p = place_single_word(p, p.words[1]);
    p.wordCount = p.wordCount + 1;

    // Word 3: code
    strcpy(p.words[2].word, "code");
    p.words[2].x1 = 8;
    p.words[2].y1 = 8;
    p.words[2].x2 = 11;
    p.words[2].y2 = 11;
    p.words[2].found = 0;
    p = place_single_word(p, p.words[2]);
    p.wordCount = p.wordCount + 1;

    return p;
}

// This checks if a word matches in a specific direction
int search_in_direction(Puzzle p, char guess[], int r, int c, int dr, int dc) {
    int len;
    int i;
    char mapChar;
    int is_match;

    len = (int)strlen(guess);
    is_match = 1; 

    for (i = 0; i < len; i++) {
        // If we go out of boundary, it's wrong
        if (r < 0) { is_match = 0; }
        if (r >= SIZE) { is_match = 0; }
        if (c < 0) { is_match = 0; }
        if (c >= SIZE) { is_match = 0; }

        if (is_match == 0) {
            return 0;
        }

        mapChar = p.map[r][c];
        
        // treat A and a the same
        if (mapChar >= 'A') {
            if (mapChar <= 'Z') {
                mapChar = mapChar + 32;
            }
        }

        // If letters don't match, fail
        if (mapChar != guess[i]) {
            return 0;
        }

        // Move to next spot
        r = r + dr;
        c = c + dc;
    }
    return 1; // Success
}

// This looks for the word in all directions around a point
int find_word_direction(Puzzle p, char guess[], int r, int c, int *dr, int *dc) {
    int i;
    int j;
    int found;

   
    for (i = -1; i <= 1; i++) {
        for (j = -1; j <= 1; j++) {
   
            if (i == 0) {
                if (j == 0) {
                    continue;
                }
            }

            found = search_in_direction(p, guess, r, c, i, j);
            if (found == 1) {
                *dr = i; 
                *dc = j; 
                return 1;
            }
        }
    }
    return 0; // Not found
}

// Changes the word on the map to uppercase to show it's found
Puzzle uppercase_found_word(Puzzle p, char guess[], int r, int c, int dr, int dc) {
    int len;
    int i;
    char current_char;

    len = (int)strlen(guess);

    for (i = 0; i < len; i++) {
        current_char = p.map[r][c];
        
        // Convert to uppercase
        if (current_char >= 'a') {
            if (current_char <= 'z') {
                current_char = current_char - 32;
            }
        }
        
        p.map[r][c] = current_char;
        r = r + dr;
        c = c + dc;
    }
    return p;
}

// Updates the word list to say this word is found
Puzzle mark_word_as_found(Puzzle p, char guess[]) {
    int i;
    int result;
    for (i = 0; i < p.wordCount; i++) {
        result = strcmp(p.words[i].word, guess);
        if (result == 0) {
            p.words[i].found = 1;
        }
    }
    return p;
}

// Checks if we found everything
int all_words_found(Puzzle p) {
    int i;
    for (i = 0; i < p.wordCount; i++) {
        if (p.words[i].found == 0) {
            return 0; // Found a word that isn't done yet
        }
    }
    return 1; // All done
}

// The main game loop
void play_game() {
    Puzzle p;
    char guess[WORD_LENGTH];
    int r;
    int c;
    int dr;
    int dc;
    int gameRunning;
    int result;
    int is_found;

    gameRunning = 1; // 1 means true/on

    p = fill_random_map(p);
    p = place_all_words(p);

    while (gameRunning == 1) {
        print_puzzle(p);
        printf("Enter word (or type 'exit' to quit): ");
        scanf("%s", guess);

        // Check for exit
        result = strcmp(guess, "exit");
        if (result == 0) {
            printf("Exiting game...\n");
            gameRunning = 0;
            break;
        }

        printf("Enter row and column: ");
        scanf("%d %d", &r, &c);

        dr = 0;
        dc = 0;

        is_found = find_word_direction(p, guess, r, c, &dr, &dc);
        if (is_found == 1) {
            printf("Correct!\n");
            p = uppercase_found_word(p, guess, r, c, dr, dc);
            p = mark_word_as_found(p, guess);
            
            if (all_words_found(p) == 1) {
                print_puzzle(p);
                printf("Congratulations! You found all words.\n");
                gameRunning = 0;
            }
        } else {
            printf("Not found.\n");
        }
    }
}